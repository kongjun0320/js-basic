# 并发模型与事件循环

JavaScript 有一个基于事件循环的并发模型，事件循环负责执行代码、收集和处理事件以及执行队列中的子任务。这个模型与其他语言中的模型截然不同，比如 C 和 Java。

## 运行时概念

接下来的内容解释了这个理论模型。现代 JavaScript 引擎实现并着重优化了以下描述的这些语义。

- 栈: 函数调用形成了一个由若干帧组成的栈。
- 堆: 对象被分配在堆中，堆是一个用来表示一大块内存区域的计算机术语。
- 队列: 一个 JavaScript 运行时包含了一个待处理消息的消息队列。每个消息都关联着一个用以处理这个消息的回调函数。在事件循环期间的某个时刻，运行时会从最先进入队列的消息开始处理队列中的消息。被处理的消息会被移除队列，并作为输入参数来调用与之关联的函数。正如前面所提到的，调用一个函数总是会为其创造一个新的栈帧。函数的处理会一直进行到执行栈再次为空为止；然后事件循环将会处理队列中的下一个消息。

## 事件循环

之所以称之为事件循环，是因为它经常按照类似如下的方式来被实现:

```js
while (queue.quitForMessage()) {
  queue.processNextMessage()
}
```

`queue.waitForMessage()`会同步地等待消息到达（如果当前没有任何消息等待被处理）

“执行至完成”

每一个消息完整地执行后，其他消息才会被执行。这为程序的分析提供了一些优秀的特性，包括：当一个函数执行时，它不会被抢占，只有在它运行完毕之后才会去运行其他的代码，才能修改这个函数操作的数据。这与 C 语言不同，例如，如果函数在线程中运行，它可能在任何位置被终止，然后在另一个线程中运行其他代码。
